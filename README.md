# backend-creditos
Desafio T√©cnico de back-end cr√©ditos INFUSE

Ôªø# üè¶ Credit Inquiry API

A Credit Inquiry API built with **Java**, featuring the using of the **Spring Boot**, and connected to a **PostgreSQL** database and with event log on **Kafka**.

## üìå Features

1. GET /api/creditos/{numeroNfse}
   - Description: Returns a list of credits based on the NFS-e number.
     - Parameter:
           - numeroNfse (String) - NFS-e identifier number
   - Expected response:
       
       ![image](https://github.com/user-attachments/assets/7fcc2914-f1e4-498d-a936-a2edac38e605)
       
3. GET /api/creditos/credito/{numeroCredito}
   - Description: Returns the details of a specific constituted credit based on the constituted credit number.
     - Parameter:
           - numeroCredito (String) - Identifier number of the constituted credit.
   - Expected response:
 
       ![image](https://github.com/user-attachments/assets/7fcc2914-f1e4-498d-a936-a2edac38e605)
       
## ‚öôÔ∏è Tech Stack

| Technology      | Description                                                            |
|-----------------|------------------------------------------------------------------------|
| Java 21         | Main programming language                                              |
| Spring Boot     | Framework for web apps                                                 |
| Spring Data JPA | Data access framework that simplifies database interactions            |
| Hibernate       | Java-based object-relational mapping (ORM) framework                   |
| PostgreSQL      | Relational database                                                    |
| Docker          | Open platform for developing, shipping and running applications        |
| Kafka           | Distributed streaming platform used to create real-time data pipelines |
| JUnit           | A unit testing framework for Java for writing and executing tests      |
| Mockito         | A simulation framework to create simulated objects in unit tests       |
| MVC             | A software architectural pattern                                       |

## üõ†Ô∏è How to Run the Project:
1. Clone the repository
```java
git clone -b master https://github.com/jorgedoriajr/backend-creditos.git
```
2. Create the network in Docker, if necessary
```java
docker network create --driver bridge my_network
```
3. Run the Maven build
```java
./mvnw clean package
```
4. Building the Docker image
```java
docker-compose build --no-cache
```
5. Running containers in Docker
```java
docker-compose up -d
```
6. Testing API calls from within the Docker Container
   - Open the Windows command prompt
     ```java
     CMD
     ```
   - Run the following commands
     ```java
     docker exec -it backend-creditos-kafka-1 sh
     ```
     ```java
     curl http://creditos-app:8080/api/creditos/1122334
     ```
     ```java
     curl http://creditos-app:8080/api/creditos/credito/123456
     ```
7. View the topic credito-topic on Kafka
   - Open your browser and enter the following url
     ```java
     http://localhost:19000
     ```
   - Select the Kafdrop options
     ```java
     Select the credito-topic
     ```
     ![image](https://github.com/user-attachments/assets/3066c85d-5e2c-4e6d-b1e4-9225d4a4196e)

     ```java
     Select the partition containing the messages
     ```
     ![image](https://github.com/user-attachments/assets/4f248c1a-c4b7-470a-9996-c0194d900536)

      ```java
     Check out the messages
     ```
      ![image](https://github.com/user-attachments/assets/e68089b1-6b73-4da1-af6c-8373ad470cc5)

8. Stop the project
```java
docker-compose down -v
```

## üßæ Coverage Test Informations
- Project over 80% coverage

  ![image](https://github.com/user-attachments/assets/fc223c21-92c1-4482-bf55-363abc0adc20)

- Service

  ![image](https://github.com/user-attachments/assets/840a058d-21ff-4691-b98c-fc9b88421d79)

- Rest Controller

  ![image](https://github.com/user-attachments/assets/e09cfab6-bdf5-45a0-a58d-a869f79833a7)

- Producer Kafka:

  ![image](https://github.com/user-attachments/assets/c28973a1-a6b7-4f93-a4a4-ddaf423e4c64)

- 100% integration test:

  ![image](https://github.com/user-attachments/assets/82f3167b-3af2-40bd-a6a7-351a988db369)

## üßæ Collection Postman
- File

  [Uploading INFUSE.postman_collection.json‚Ä¶]()


## üßæ Database Schema Informations
```java
create schema if not exists infuse;

CREATE TABLE infuse.credito (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY,
    numero_credito VARCHAR(50) NOT NULL,
    numero_nfse VARCHAR(50) NOT NULL,
    data_constituicao DATE NOT NULL,
    valor_issqn DECIMAL(15, 2) NOT NULL,
    tipo_credito VARCHAR(50) NOT NULL,
    simples_nacional BOOLEAN NOT NULL,
    aliquota DECIMAL(5, 2) NOT NULL,
    valor_faturado DECIMAL(15, 2) NOT NULL,
    valor_deducao DECIMAL(15, 2) NOT NULL,
    base_calculo DECIMAL(15, 2) NOT NULL
);

NSERT INTO credito (numero_credito, numero_nfse,
                    data_constituicao, valor_issqn,
                    tipo_credito, simples_nacional,
                    aliquota, valor_faturado,
                    valor_deducao, base_calculo)
VALUES
('123456', '7891011', '2024-02-25', 1500.75, 'ISSQN', true, 5.0, 30000.00, 5000.00, 25000.00),
('789012', '7891011', '2024-02-26', 1200.50, 'ISSQN', false, 4.5, 25000.00, 4000.00, 21000.00),
('654321', '1122334', '2024-01-15', 800.50, 'Outros', true, 3.5, 20000.00, 3000.00, 17000.00);
```

## üôã Author
Made by Jorge Viana Doria Junior
